# Testes de acessibilidade com Cypress

A acessibilidade, frequentemente abreviada como _a11y_ (pelo fato da palavra _accessibility_ ter onze caracteres entre o 'a' e o 'y'), Ã© uma faceta essencial do desenvolvimento de software que visa garantir que produtos e serviÃ§os sejam utilizÃ¡veis por pessoas com uma variedade de deficiÃªncias. Isso inclui deficiÃªncias visuais, auditivas, fÃ­sicas, de fala, cognitivas e neurolÃ³gicas.

A acessibilidade Ã© importante nÃ£o apenas do ponto de vista Ã©tico e de inclusÃ£o, mas tambÃ©m comercial, pois amplia o pÃºblico-alvo e cumpre com as regulamentaÃ§Ãµes legais como a Lei Brasileira de InclusÃ£o da Pessoa com DeficiÃªncia, a _ADA_ (_Americans with Disabilities Act_) e a _WCAG_ (_Web Content Accessibility Guidelines_).

No mundo dos testes automatizados web com Cypress, Ã© possÃ­vel criar testes de acessibilidade, unindo duas ferramentas. SÃ£o elas:

- [`axe-core`](https://www.npmjs.com/package/axe-core): Uma biblioteca de teste de acessibilidade que pode ser integrada a vÃ¡rias ferramentas de testes automatizados, incluindo o Cypress.
- [`cypress-axe`](https://www.npmjs.com/package/cypress-axe): Este plugin do Cypress permite incorporar testes de acessibilidade automaticamente em seus testes _end-to-end_ usando a biblioteca `axe-core`.

## O que Ã© verificado em testes automatizados de acessibilidade?

Em testes de acessiblidade automatizados, Ã© possÃ­vel identificar diferentes problemas de acessiblidade, tais como:

- Contraste entre cor de fundo e cor da fonte
- Uso de elementos semÃ¢nticos
- Ordem de cabeÃ§alhos (`h1`, `h2`, ..., `h6`)
- Etc.

> ğŸ‘¨â€ğŸ« Vale lembrar que testes automatizados de acessiblidade sÃ£o limitados ao que Ã© possÃ­vel encontrar de forma automÃ¡tica, mas isso nÃ£o descarta outros tipos de testes, tais como testes em par com pessoas com deficiÃªncia, testes com leitores de tela, etc.

## Passo-a-passo para configurar o plugin `cypress-axe`

Para iniciar testes automatizados com Cypress e o plugin `cypress-axe`, basta seguir os seguintes passos:

1. Instale ambas as bibliotecas `axe-core` e `cypress-axe` como dependÃªncias de desenvolvimento (levando em consideraÃ§Ã£o que o `cypress` jÃ¡ esteja instalado), nas versÃµes 4.10.2 e 1.5.0, respectivamente. Assim: `npm i axe-core@4.10.2 cypress-axe@1.5.0 -D`
2. Importe a biblioteca `cypress-axe` dentro do arquivo `cypress/support/e2e.js`. Assim: `import 'cypress-axe'`
3. Injete o _Axe_ logo apÃ³s a visita Ã  URL da aplicaÃ§Ã£o em teste. Assim: `cy.injectAxe()`
4. Por fim, execute as verificaÃ§Ãµes de acessibilidade em diferentes momentos, enquanto o Cypress roda, utilizando o comando `cy.checkA11y()`.

## ExercÃ­cio 1 ğŸ¯

1. Primeiro de tudo, siga os passos acima para configurar o plugin `cypress-axe`
2. Na pasta `cypress/e2e/`, crie um arquivo chamado `a11y.cy.js`
3. Crie a estrutura bÃ¡sica para a suÃ­te de testes de acessiblidade. Algo assim:

```js
describe("Cypress Simulator - A11y Checks", () => {
  beforeEach(() => {
    cy.visit("./src/index.html?skipCaptcha=true", {
      onBeforeLoad(win) {
        win.localStorage.setItem("cookieConsent", "accepted")
      }
    })
    cy.contains("button", "Login").click()
    cy.injectAxe()
  })

  it("test case 1", () => {})

  it("test case 2", () => {})

  // ...

  it("test case n", () => {})
})

```

4. Mova os seguintes testes do arquivo `cypress/e2e/cypress-simulator.cy.js` para o arquivo `cypress/e2e/a11y.cy.js`:

- `it successfully simulates a Cypress command (e.g., cy.log('Yay!'))`
- `it shows an error when entering and running an invalid Cypress command (e.g., cy.run())`
- `it shows a warning when entering and running a not-implemented Cypress command (e.g., cy.contains('Login'))`
- `it asks for help and gets common Cypress commands and examples with a link to the docs`
- `it maximizes and minimizes a simulation result`
- `it logs out successfully`
- `it shows and hides the logout button`
- `it shows the running state before showing the final result`
- `it consents on the cookies usage` ou `it declines on the cookies usage`
- `it disables the captcha verify button when no answer is provided or it's cleared`
- `it shows an error on a wrong captcha answer and goes back to its initial state`

> ğŸ‘¨â€ğŸ« A idÃ©ia aqui Ã© pegar diferentes estados da aplicaÃ§Ã£o onde pode-se encontrar algum dos problemas de acessibilidade citados anterioremente.

5. Siga para o exercÃ­cio 2

## ExercÃ­cio 2 ğŸ¯

Para cada um dos testes listados abaixo, implemente uma verificaÃ§Ã£o de acessibilidade.

- `it maximizes and minimizes a simulation result`
- `it logs out successfully`
- `it shows and hides the logout button`
- `it shows the running state before showing the final result`
- `it consents on the cookies usage` ou `it declines on the cookies usage`

> ğŸ‘¨â€ğŸ« Pense bem nos diferentes estados da aplicaÃ§Ã£o para que tal verificaÃ§Ã£o seja adicionada no momento correto, como apÃ³s alguma verificaÃ§Ã£o de resultado esperado intermediÃ¡ria ou final.
>
> ğŸ’¥ Ao executar a primeira verificaÃ§Ã£o de acessibilidade, vocÃª deve perceber um erro (`html-has-lang`).

Abra o console do navegador, investigue e corrija a falha, e siga adiante somente quando as verificaÃ§Ãµes de acessibilidade estiverem passando. ğŸ•µï¸

## ExercÃ­cio 3 ğŸ¯

Junte ambos casos de teste do captcha em um Ãºncio caso de teste, e adicione duas verificaÃ§Ãµes de acessibilidade: uma antes e outra depois da exibiÃ§Ã£o da mensagem de erro.

> ğŸ§‘â€ğŸ« Aqui vai uma sugestÃ£o de descriÃ§Ã£o para o caso de teste: `it finds no a11y issues on all captcha view states (button enabled/disabled and error)`.
>
> ğŸ™Š Quando o votÃ£o _Verify_ nÃ£o estiver habilitado nÃ£o precisa de verificaÃ§Ã£o de acessibilidade. Quer saber por quÃª? Continue lendo.
>
> ğŸ‘¨â€ğŸ« "Componentes de Interface do UsuÃ¡rio que nÃ£o estÃ£o disponÃ­veis para interaÃ§Ã£o do usuÃ¡rio (por exemplo, um controle desabilitado em HTML) nÃ£o sÃ£o necessÃ¡rios para atender aos requisitos de contraste."
>
> Fonte: https://www.w3.org/WAI/WCAG21/Understanding/contrast-minimum.html

## ExercÃ­cio 4 ğŸ¯

Ao executar o teste do exercÃ­cio anterior, vocÃª deve perceber um problema de acessibilidade com relaÃ§Ã£o ao contraste entre a cor de fundo e a cor da fonte da mensagem de erro.

1. Abra o arquivo `src/style.css` e procure por 'captcha'
2. Proponha uma soluÃ§Ã£o para resolver tal problema.

 > ğŸ™Š Altere a cor da fonte (`color`) da mensagem de erro do captcha para `#AB1A0D`.

## ExercÃ­cio 5 ğŸ¯

Para cada um dos testes listados abaixo, implemente uma verificaÃ§Ã£o de acessibilidade, logo apÃ³s suas verificaÃ§Ãµes de resultado esperado.

- `it successfully simulates a Cypress command (e.g., cy.log('Yay!'))`
- `it shows an error when entering and running an invalid Cypress command (e.g., cy.run())`
- `it shows a warning when entering and running a not-implemented Cypress command (e.g., cy.contains('Login'))`
- `it asks for help and gets common Cypress commands and examples with a link to the docs`

> ğŸ‘¨â€ğŸ« Para experimentar e obter mais experÃªncia com o uso do plugin `cypress-axe`, passe um seletor CSS ao comando `cy.checkA11y()`, para verificar que nÃ£o hÃ¡ problemas de acessibilidade somente na Ã¡rea do resultado da execuÃ§Ã£o de uma simulaÃ§Ã£o de um comando do Cypress, nÃ£o na pÃ¡gina toda.
>
> NÃ£o sabe do que estou falando? Leia sobre o [contexto da verificaÃ§Ã£o de acessibilidade direto da documentaÃ§Ã£o oficial do plugin](https://www.npmjs.com/package/cypress-axe#context-optional).

## ConteÃºdos sugeridos ğŸ“š

- [_Playlist_ com conteÃºdos sobre acessibilidade no Canal TAT no YouTube](https://www.youtube.com/playlist?list=PL-eblSNRj0QH_HJ4lxiWVS9TazxCsA1Ba)
- [Guia WCAG](https://guia-wcag.com/)
- [Livro: Acessibilidade na Web - Boas prÃ¡ticas para construir sites e aplicaÃ§Ãµes acessÃ­veis](https://www.casadocodigo.com.br/products/livro-acessibilidade), do autor [Reinaldo Ferraz](https://reinaldoferraz.com.br/)
- [Podcast Foco Acessivel](https://open.spotify.com/show/4D6HigcXDCdNuCXxrkStWL), por Wagner Beethoven
- [_Newsletter_ do Bruno Pulis](https://brunopulis.com/newsletter/)

## Mostre ao mundo o que vocÃª aprendeu ğŸŒ

Para mostrar Ã  sua rede profissional o que vocÃª aprendeu nesta aula, publique o seguinte no LinkedIn.

> Estou fazendo o curso "_Cypress Simulator_" da escola online Talking About Testing, onde aprendi como criar testes de acessibilidade automatizados com as bibliotecas `axe-core` e `cypress-axe`. #TalkingAboutTesting #EscolaTAT #CypressSimulator #Cypress
>
> ğŸ‘¨â€ğŸ« Lembre-se de me marcar em sua publicaÃ§Ã£o. [Aqui estÃ¡ meu perfil no LinkedIn](https://www.linkedin.com/in/walmyr-lima-e-silva-filho).

___

ParabÃ©ns! ğŸ‰ Vamos para a [liÃ§Ã£o 17](./17.md) para criar alguns comandos customizados, tanto para o login, quanto para rodar um comando no _Cypress Simulator_. Dessa forma, evitaremos cÃ³digo duplicado ao longo dos testes.
