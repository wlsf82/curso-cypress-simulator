# Implementando o caso de teste mais importante

Em vez de uma competiÃ§Ã£o de quem pensa ou escreve mais casos de teste, Ã© importante pensar bem e implementar antes de mais nada o caso de teste mais importante, Ã quele essencial, o qual, se nÃ£o estiver passando, nÃ£o atende Ã s necessidades primÃ¡rias dos/as usuÃ¡rios/as do software.

Na aplicaÃ§Ã£o _Cypress Simulator_, tal caso de teste Ã© o caso em que apÃ³s autenticado/a no sistema, o/a usuÃ¡rio/a consegue executar a simulaÃ§Ã£o de um comando do Cypress com sucesso.

No entanto, para testar o cenÃ¡rio de sucesso, o/a usuÃ¡rio/a deve primeiro efetuar login. Ou seja, o cenÃ¡rio de sucesso possui uma prÃ©-condiÃ§Ã£o, a qual deve ser atendida antes da implementaÃ§Ã£o do teste propriamente dito.

AlÃ©m disso, por questÃµes de seguranÃ§a um ["Captcha"](https://pt.wikipedia.org/wiki/CAPTCHA) deve ser resolvido apÃ³s o login, porÃ©m, Captchas sÃ£o feitos para que nÃ£o possam ser resolvidos por "robÃ´s". ğŸ¤–

E agora?

Uma alternativa sugerida quando lidando com Captchas em testes automatizados Ã© o uso de uma _feature flag_ que desliga o Captcha durante a execuÃ§Ã£o dos testes automatizados. No entanto, tal mecanismo precisa ser implementado, ou seja, o time que desenvolveu a aplicaÃ§Ã£o deve ter pensado na "testabilidade" da mesma.

Para sua "sorte", a aplicaÃ§Ã£o _Cypress Simulator_ possui tal mecanismo. Basta passar a _feature flag_ `skipCaptcha=true` como parÃ¢metro da URL e pula-se tal etapa.

## ExercÃ­cio 1 ğŸ¯

Visto que o login Ã© uma prÃ©-condiÃ§Ã£o para o teste, nÃ£o parte do teste propriamente dito, Ã© melhor isolÃ¡-lo com o [_hook_](https://docs.cypress.io/app/core-concepts/writing-and-organizing-tests#Hooks) `beforeEach`, o qual Ã© executado antes de cada bloco `it` (cada caso de teste).

Portanto, dentro da funÃ§Ã£o de _callback_ do _hook_ `beforeEach`, implemente os passos necessÃ¡rios para a realizaÃ§Ã£o do login, pulando a etapa do Captcha com o uso da _feature flag_ citada acima.

> ğŸ‘¨â€ğŸ« Tal etapa serÃ¡ valiosa, pois muitos dos outros testes que escreveremos necessitarÃ£o do/a usuÃ¡rio/a jÃ¡ autenticado/a, e ao definir tais passos no `beforeEach`, nÃ£o precisaremos mais se preocupar com isso.

## ExercÃ­cio 2 ğŸ¯

ApÃ³s o login, o/a usuÃ¡rio/a jÃ¡ pode interagir com a aplicaÃ§Ã£o, no entanto, ainda hÃ¡ algo que por vezes pode atrapalhar nos testes.

O _banner_ de consentimento de _cookies_.

E se tal _banner_ ficar na frente de algum elemento com o qual o teste precisa interagir, como uma Ã¡rea de texto ou um botÃ£o?

Seria melhor fechar tal _banner_, nÃ£o?

Mas ter que clicar em _Accept_ ou _Decline_ antes de cada teste seria um passo a mais, um passo que adicionaria algum tempo a mais na execuÃ§Ã£o dos testes, por mais que mÃ­nimo.

E se pudÃ©ssemos pular essa etapa tambÃ©m?

Ao clicar em _Accept_ ou _Decline_, uma _key_ chamada `cookieConsent` Ã© adicionada ao _local storage_ com um dos seguintes valores: `accepted` ou `declined`.

A parte boa Ã© que o comando [`cy.visit`](https://docs.cypress.io/api/commands/visit) do Cypress pode receber alÃ©m da URL da aplicaÃ§Ã£o como primeiro parÃ¢metro, um objeto de _options_, como segundo parÃ¢metro, e tal objeto, pode conter a opÃ§Ã£o `onBeforeLoad`, para a qual pode ser passada [uma funÃ§Ã£o de _callback_ que Ã© chamada antes da pÃ¡gina carregar](https://docs.cypress.io/api/commands/visit#Provide-an-onBeforeLoad-callback-function).

Tal funÃ§Ã£o de _callback_ recebe como argumento um objeto que representa a janela do navegador (`window`), e a partir de tal objeto, Ã© possÃ­vel acessar e definir um item no `localStorage` (veja um exemplo abaixo).

> ğŸ™Š

```js
cy.visit("./src/index.html?skipCaptcha=true", {
  onBeforeLoad(win) {
    win.localStorage.setItem("cookieConsent", "accepted")
  }
})

```

O _snippet_ de cÃ³digo acima define que os _cookies_ jÃ¡ foram aceitos antes da pÃ¡gina carregar, e quando a mesma carrega, o _banner_ nÃ£o aparece mais.

Seu exercÃ­cio Ã© aplicar tal mudanÃ§a de modo que o _banner_ nÃ£o seja exibido apÃ³s o login.

## ExercÃ­cio 3 ğŸ¯

Por fim, implemente o teste que executa uma simulaÃ§Ã£o bem sucedida de um comando do Cypress, garantindo que tal funcionalidade atende Ã s expectativas dos/as usuÃ¡rios/as.

Ao implementar tal teste, tenha em mente que, ao digitar um comando vÃ¡lido do Cypress e pressionar o botÃ£o _Run_, a aplicaÃ§Ã£o _Cypress Simulator_ "simula" uma chamada Ã  um servidor, o qual pode demorar tempos distintos para responder ao _frontend_.

Por padrÃ£o, [comandos de _query_](https://docs.cypress.io/api/table-of-contents#Queries) do Cypress, como [`cy.get`](https://docs.cypress.io/api/commands/get) e [`cy.contains`](https://docs.cypress.io/api/commands/contains), esperam por atÃ© 4 segundos antes de falhar, atravÃ©s de um mecanismo chamado [_Retry-ability_](https://docs.cypress.io/app/core-concepts/retry-ability).

Mas e se esse um servidor demora mais do que 4 segundos para responder?

Uma alternativa para lidar com tal situaÃ§Ã£o Ã© alterar o _timeout_ padrÃ£o de um comando de _query_, como `cy.get` ou `cy.contains`, para um tempo maior. Algo assim: `cy.get("#outputArea", { timeout: 6000 })`.

Agora sim, vai lÃ¡ e implementa o teste.

> ğŸ§‘â€ğŸ« Aqui vai uma sugestÃ£o de descriÃ§Ã£o para o caso de teste: `it successfully simulates a Cypress command (e.g., cy.log('Yay!'))`.

### ConteÃºdo sugerido

- [Vamos conversar sobre os timeouts do Cypress](https://youtube.com/live/pb4gCXRt_4Y?feature=share)

## Mostre ao mundo o que vocÃª aprendeu ğŸŒ

Para mostrar Ã  sua rede profissional o que vocÃª aprendeu nesta aula, publique o seguinte no LinkedIn.

> Estou fazendo o curso "_Cypress Simulator_" da escola online Talking About Testing e acabei de implementar o primeiro teste, o qual garante que a funcionalidade principal do aplicaÃ§Ã£o atende Ã s necessidades de seus/suas usuÃ¡rios/as. AlÃ©m disso, aprendi como utilizar _feature flags_ para pular a etapa de Captcha e tambÃ©m como definir um item direto no _local storage_ para evitar o aparecimento do _banner_ de consentimento de _cookies_. Por fim aprendi como controlar o _timeout_ do Cypress em seus comandos de _query_ para tornar os testes mais robustos. #TalkingAboutTesting #EscolaTAT #CypressSimulator #Cypress
>
> ğŸ‘¨â€ğŸ« Lembre-se de me marcar em sua publicaÃ§Ã£o. [Aqui estÃ¡ meu perfil no LinkedIn](https://www.linkedin.com/in/walmyr-lima-e-silva-filho).

___

ParabÃ©ns! ğŸ‰ Vamos para a [liÃ§Ã£o 3](./03.md) para dar continuidade com os prÃ³ximos testes.
